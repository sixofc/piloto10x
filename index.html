<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Piloto do 10X</title>
  <style>
    /* Todo o seu CSS original, sem alterações */
    :root { /* ... */ }
    /* Continua tudo conforme o que você enviou anteriormente */
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <!-- LOGIN -->
  <section id="login-section">
    <div class="card">
      <h1 class="mainTitle" style="text-align:center;">Login</h1>
      <label for="loginUser" style="margin-top:12px;">E‑mail</label>
      <input type="text" id="loginUser" placeholder="Seu e‑mail" />
      <label for="loginPass" style="margin-top:12px;">Senha</label>
      <input type="password" id="loginPass" placeholder="Sua senha" />
      <button id="btnLogin" class="primary">Entrar</button>
      <button id="btnGetLogin" class="link-button">Adquira seu login</button>
      <div id="loginError" class="error" style="display:none;"></div>
    </div>
  </section>

  <!-- Botões Admin -->
  <button id="btnAdminCreateUser" style="display:none;">Criar novo usuário</button>
  <button id="btnLogout" style="display:none;">Desconectar</button>

  <!-- APP -->
  <div id="app" style="display:none;">
    <div class="wrap">
      <div class="card" role="main">
        <!-- VIEW 1 -->
        <section id="view-landing" class="center">
          <h1 class="mainTitle">Piloto do 10X</h1>
          <p class="subtitle">Instagram: @pilotodo10x</p>
          <div class="search" style="margin-top:8px">
            <input id="urlInput" type="text" placeholder="Cole o link do post" />
          </div>
          <button id="btnAction" class="primary">Buscar</button>
          <div id="loading" class="smallLoader" style="display:none;">
            <div class="loaderDot"></div>
            <div>Carregando...</div>
          </div>
          <div id="result" class="result" style="display:none;"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- MODAL criar usuário -->
  <div id="createUserModal" style="display:none;">
    <div class="card">
      <h2>Criar novo usuário</h2>
      <label>Email</label>
      <input type="text" id="newUserName" placeholder="E‑mail" />
      <label>Senha</label>
      <input type="password" id="newUserPass" placeholder="Senha" />
      <label>Confirmar senha</label>
      <input type="password" id="newUserPassConfirm" placeholder="Confirmar senha" />
      <button id="btnCreateUser" class="primary">Criar usuário</button>
      <button id="btnCloseModal" class="link-button">Cancelar</button>
      <div id="createUserError" class="error" style="display:none;"></div>
      <div id="createUserSuccess" class="success" style="display:none;"></div>
    </div>
  </div>

  <script>
  (async () => {
    const SUPABASE_URL = 'https://zsabvugbpleckaebmwsf.supabase.co';     // Substitua aqui
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzYWJ2dWdicGxlY2thZWJtd3NmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5NDgxMTgsImV4cCI6MjA3MDUyNDExOH0.beO3HfmCgw42fR2ySWmjQ15qS0MRsq1JV7igMFtxjCM';             // Substitua aqui
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const loginSection = document.getElementById('login-section');
    const loginUser = document.getElementById('loginUser');
    const loginPass = document.getElementById('loginPass');
    const loginError = document.getElementById('loginError');
    const btnLogin = document.getElementById('btnLogin');
    const btnGetLogin = document.getElementById('btnGetLogin');
    const btnAdminCreateUser = document.getElementById('btnAdminCreateUser');
    const btnLogout = document.getElementById('btnLogout');
    const createUserModal = document.getElementById('createUserModal');
    const newUserName = document.getElementById('newUserName');
    const newUserPass = document.getElementById('newUserPass');
    const newUserPassConfirm = document.getElementById('newUserPassConfirm');
    const createUserError = document.getElementById('createUserError');
    const createUserSuccess = document.getElementById('createUserSuccess');
    const btnCreateUser = document.getElementById('btnCreateUser');
    const btnCloseModal = document.getElementById('btnCloseModal');
    const app = document.getElementById('app');
    const btnAction = document.getElementById('btnAction');
    const urlInput = document.getElementById('urlInput');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');

    function mostraErro(el, msg) { el.textContent = msg; el.style.display = 'block'; }
    function limpaErro(el) { el.textContent = ''; el.style.display = 'none'; }
    function limpaCamposLogin() { loginUser.value = ''; loginPass.value = ''; limpaErro(loginError); }

    async function atualizaUIposLogin() {
      const { data } = await supabase.auth.getSession();
      const user = data.session?.user;
      if (!user) {
        loginSection.style.display = 'flex';
        app.style.display = 'none';
        btnAdminCreateUser.style.display = 'none';
        btnLogout.style.display = 'none';
        return;
      }
      loginSection.style.display = 'none';
      app.style.display = 'block';
      btnLogout.style.display = 'block';
      const isAdmin = user.user_metadata?.isAdmin;
      btnAdminCreateUser.style.display = isAdmin ? 'block' : 'none';
    }

    btnLogin.addEventListener('click', async () => {
      limpaErro(loginError);
      const email = loginUser.value.trim();
      const password = loginPass.value.trim();
      if (!email || !password) {
        mostraErro(loginError, 'Preencha e‑mail e senha.');
        return;
      }
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) return mostraErro(loginError, 'Usuário ou senha inválidos.');
      limpaCamposLogin();
      atualizaUIposLogin();
    });

    btnLogout.addEventListener('click', async () => {
      await supabase.auth.signOut();
      atualizaUIposLogin();
    });

    btnAdminCreateUser.addEventListener('click', () => {
      createUserModal.style.display = 'flex';
      limpaErro(createUserError);
      createUserSuccess.style.display = 'none';
      newUserName.value = newUserPass.value = newUserPassConfirm.value = '';
      newUserName.focus();
    });

    btnCloseModal.addEventListener('click', () => {
      createUserModal.style.display = 'none';
    });

    btnCreateUser.addEventListener('click', async () => {
      limpaErro(createUserError);
      createUserSuccess.style.display = 'none';
      const email = newUserName.value.trim();
      const senha = newUserPass.value.trim();
      const confirm = newUserPassConfirm.value.trim();
      if (!email || !senha || !confirm) {
        mostraErro(createUserError, 'Preencha todos os campos.');
        return;
      }
      if (senha !== confirm) {
        mostraErro(createUserError, 'As senhas não coincidem.');
        return;
      }
      const { error } = await supabase.auth.signUp({ email, password: senha, options: { data: { isAdmin: false } } });
      if (error) {
        mostraErro(createUserError, 'Erro: ' + error.message);
      } else {
        createUserSuccess.textContent = 'Usuário criado!';
        createUserSuccess.style.display = 'block';
        newUserName.value = newUserPass.value = newUserPassConfirm.value = '';
      }
    });

    const { data: initial } = await supabase.auth.getSession();
    if (initial.session) usuarioLogado = true;
    atualizaUIposLogin();

    btnAction.addEventListener('click', () => {
      const val = urlInput.value.trim().toLowerCase();
      if (val.includes('bwkbet')) {
        loading.style.display = 'flex';
        setTimeout(() => {
          loading.style.display = 'none';
          app.innerHTML = `
            <!-- VIEW 2 -->
            <section id="view-hack" class="page2">
              <div class="bigTitle">Piloto do 10X</div>
              <div class="entryBox">
                <div id="resultArea" class="result">
                  <div class="label">Entrada localizada</div>
                  <div id="entryTime" class="value">${new Date().toLocaleTimeString()}</div>
                  <div class="label" style="margin-top:12px">Probabilidade</div>
                  <div id="prob" class="value">3x à 10x</div>
                </div>
              </div>
            </section>`;
        }, Math.floor(Math.random()*3000)+3000);
      } else {
        result.style.display = 'block';
        result.textContent = 'Por enquanto não hackeamos o Aviator dessa plataforma!';
      }
    });
  })();
  </script>
</body>
</html>
